<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flanker Test</title>
    <style>
        body {
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            overflow: hidden;
        }

        h1 {
            font-size: 2.5em;
            color: #333;
            margin: 0;
            position: fixed; /* Fixing the title to the top */
            top: 20px; /* Slight margin from the top */
            left: 50%;
            transform: translateX(-50%); /* Center the title horizontally */
            z-index: 10; /* Ensures the title is above other elements */
        }

        button {
            font-size: 18px;
            padding: 12px 24px;
            cursor: pointer;
            margin: 15px;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            border: none;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        #countdown {
            font-size: 40px;
            font-weight: bold;
            color: #555;
        }

        #progressBarContainer {
            width: 80%;
            height: 15px;
            background-color: #e0e0e0;
            position: fixed;
            bottom: 20px; /* Fixed at the bottom */
            left: 50%;
            transform: translateX(-50%); /* Center the progress bar horizontally */
            border-radius: 10px;
            overflow: hidden;
            z-index: 5; /* Ensures it stays above other elements */
        }

        #progressBar {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            border-radius: 10px;
        }

        #arrowContainer {
            font-size: 166px; /* Decreased the arrow size by 1.5 times */
            margin-top: 80px; /* Add space below the fixed title */
            display: none;
        }

        .arrow {
            padding: 7px; /* Reduced padding by 30% to bring arrows closer */
            color: #333;
        }

        #result {
            font-size: 1.2em;
            margin-top: 30px;
            color: #333;
            display: none;
        }

        #restartButton {
            display: none;
            font-size: 18px;
            padding: 12px 24px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        #restartButton:hover {
            background-color: #218838;
        }

        /* Instructions screen styling */
        #instructionsScreen {
            display: none;
            font-size: 20px;
            color: #333;
            margin-top: 50px;
        }

        #understoodButton {
            background-color: #28a745;
            margin-top: 20px;
        }

    </style>
</head>
<body>

    <div>
        <h1>Flanker Task</h1>
        <button id="startButton">Start Test</button>
        <div id="countdown"></div>
        <div id="arrowContainer"></div>
        <p id="result"></p>
        <button id="restartButton">Restart</button>
    </div>
    
    <div id="progressBarContainer">
        <div id="progressBar"></div>
    </div>

    <!-- Instructions Screen -->
    <div id="instructionsScreen">
        <p>INSTRUCTIONS</p>
        <p>In this task, you'll see arrows on the screen. Your job is to identify the direction of the center arrow and ignore the surrounding arrows. Press the left arrow key if the center arrow points left, and the right arrow key if it points right.</p>
        <button id="understoodButton">Understood</button>
    </div>

    <script>
        let trials = [];
        let currentTrial = 0;
        let startTime;
        let reactionTimes = { congruent: 0, incongruent: 0 };
        let wrongGuesses = 0;

        document.getElementById("startButton").addEventListener("click", showInstructions);
        document.getElementById("restartButton").addEventListener("click", startCountdown);
        document.getElementById("understoodButton").addEventListener("click", startCountdown);

        function showInstructions() {
            document.getElementById("startButton").style.display = "none"; 
            document.getElementById("instructionsScreen").style.display = "block"; 
        }

        function startCountdown() {
            document.getElementById("instructionsScreen").style.display = "none";
            document.getElementById("countdown").style.display = "block";
            document.getElementById("countdown").textContent = "Starting in 5...";

            let count = 5;
            let countdownInterval = setInterval(() => {
                count--;
                document.getElementById("countdown").textContent = `Starting in ${count}...`;
                if (count === 0) {
                    clearInterval(countdownInterval);
                    document.getElementById("countdown").style.display = "none";
                    startTest();
                }
            }, 1000);
        }

        function startTest() {
            document.getElementById("arrowContainer").style.display = "block";
            trials = generateTrials();
            currentTrial = 0;
            reactionTimes = { congruent: 0, incongruent: 0 };
            wrongGuesses = 0;
            runTrial();
        }

        function generateTrials() {
            let trialCount = 20;
            let trialsArray = [];
            for (let i = 0; i < trialCount; i++) {
                trialsArray.push(i % 2 === 0);
            }
            return trialsArray.sort(() => Math.random() - 0.5);
        }

        function runTrial() {
            if (currentTrial >= trials.length) {
                endTest();
                return;
            }

            let isCongruent = trials[currentTrial];
            let targetDirection = Math.random() < 0.5 ? "←" : "→";
            let flankerDirection = isCongruent ? targetDirection : (targetDirection === "←" ? "→" : "←");

            let arrowRow = 
                `<span class="arrow">${flankerDirection}</span>
                <span class="arrow">${flankerDirection}</span>
                <span class="arrow">${targetDirection}</span>
                <span class="arrow">${flankerDirection}</span>
                <span class="arrow">${flankerDirection}</span>`;

            document.getElementById("arrowContainer").innerHTML = "";
            let delay = Math.floor(Math.random() * (1500 - 500 + 1)) + 500;

            setTimeout(() => {
                document.getElementById("arrowContainer").innerHTML = arrowRow;
                startTime = Date.now();

                let timeout = setTimeout(() => {
                    document.removeEventListener("keydown", keyPressHandler);
                    document.getElementById("arrowContainer").innerHTML = "";
                    currentTrial++;
                    updateProgressBar();
                    runTrial();
                }, 1700);

                function keyPressHandler(event) {
                    if ((targetDirection === "←" && event.key === "ArrowLeft") || (targetDirection === "→" && event.key === "ArrowRight")) {
                        let reactionTime = Date.now() - startTime;
                        if (isCongruent) {
                            reactionTimes.congruent += reactionTime;
                        } else {
                            reactionTimes.incongruent += reactionTime;
                        }
                        clearTimeout(timeout);
                        document.removeEventListener("keydown", keyPressHandler);
                        document.getElementById("arrowContainer").innerHTML = "";
                        currentTrial++;
                        updateProgressBar();
                        runTrial();
                    } else {
                        wrongGuesses++;
                        clearTimeout(timeout);
                        document.removeEventListener("keydown", keyPressHandler);
                        document.getElementById("arrowContainer").innerHTML = "";
                        currentTrial++;
                        updateProgressBar();
                        runTrial();
                    }
                }

                document.addEventListener("keydown", keyPressHandler);
            }, delay);
        }

        function updateProgressBar() {
            let progress = ((currentTrial / trials.length) * 100);
            document.getElementById("progressBar").style.width = progress + "%";
        }

        function endTest() {
            document.getElementById("arrowContainer").style.display = "none";
            document.getElementById("result").innerHTML = 
                `<strong>Results:</strong><br>
                Total Reaction Time (Congruent): ${reactionTimes.congruent} ms<br>
                Total Reaction Time (Incongruent): ${reactionTimes.incongruent} ms<br>
                Total Wrong Guesses: ${wrongGuesses}`;
            document.getElementById("result").style.display = "block";
            document.getElementById("restartButton").style.display = "block";
        }
    </script>

</body>
</html>
